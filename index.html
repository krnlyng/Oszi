<!-- 
Oszi web based digital storage oscilloscope client.
Copyright (C) 2010  Daniel GrÃ¶ber, Franz Haider

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. 
-->

<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Digitales Speicher-Oszilloskop mit VGA Anschluss</title>
	<script src="ajax_new.js" type="text/javascript" charset="utf-8"></script>
	<style type="text/css">
	.graf {
		border:20px solid #cccccc;
	}

	input.btn { 
		color:#050;
		background-color:#fed; 
		border:1px solid; 
		border-color: #696 #363 #363 #696; 
	}
	
	.label {
		font-family:"Lucida Console", Monospace;
		font-size:.75em;
	}
	</style>
	<script type="text/javascript">

	
	var render_cursors_text = function()
	{
		var cWidth = getCanvas().width;
		
		var canvasHeight = getCanvas().height;
		var halfCanvasHeight = canvasHeight / 2;
		
		var canvasWidth = getCanvas().width;
		var halfCanvasWidth = canvasWidth/2;
		
		if(cursorType == 1)
		{
			// Voltage
			
			var voltsPerDiv = scaleStuff(voltsScale).rawNumber;
			
			var cursor1Val = -1 * (((cursor1Pos-halfCanvasHeight)/canvasHeight) * voltsPerDiv * 10).toFixed(2);
			var text = cursor1Val + scaleStuff(voltsScale).scale_str;
			var textWidth = getCanvasContext().measureText(text).width;
			getCanvasContext().fillText(text, cWidth-textWidth,cursor1Pos-5);
			
			var cursor2Val = -1 * (((cursor2Pos-halfCanvasHeight)/canvasHeight) * voltsPerDiv * 10).toFixed(2);
			var text = cursor2Val + scaleStuff(voltsScale).scale_str;
			var textWidth = getCanvasContext().measureText(text).width;
			getCanvasContext().fillText(text, cWidth-textWidth,cursor2Pos-5);
			
			var deltaV = (cursor1Val - cursor2Val).toFixed(1);
			var text = deltaV + scaleStuff(voltsScale).scale_str;
			var textWidth = getCanvasContext().measureText(text).width;
			getCanvasContext().fillText("Delta: " + text, textWidth-10, 11);
		}else if(cursorType == 2)
		{
			// Time
			
			var timePerDiv = scaleStuff(timeScale).rawNumber;
			
			var cursor1Val = ((cursor1Pos/canvasWidth) * timePerDiv * 10).toFixed(2);
			var text = cursor1Val + scaleStuff(timeScale).scale_str;
			getCanvasContext().fillText(text, cursor1Pos, 10);
			
			var cursor2Val = ((cursor2Pos/canvasWidth) * timePerDiv * 10).toFixed(2);
			var text = cursor2Val + scaleStuff(timeScale).scale_str;
			getCanvasContext().fillText(text, cursor2Pos, 10);
		
		
			var deltaT = (cursor2Val - cursor1Val).toFixed(1);
			var text = deltaT + scaleStuff(timeScale).scale_str;
			var textWidth = getCanvasContext().measureText(text).width;
			getCanvasContext().fillText("Delta: " + text, 80, 11);
		}
	}
	renderHooks.push(render_cursors_text);
	</script>
</head>
<body onload="ajax('next_str.html')">
	<!-- <div id="graf" class="graf"></div> -->
	<canvas id="gridCanvas" width="500" height="250" class="graf"></canvas>
	<div>
		<input type="button" value="AC" class="btn" onclick="couplingChanged(this);"/>
		<span class="label">TIME / DIV:</span>
		<select id="timescale" onchange="timescaleChanged(this.value);">
			<option value="1s">1s</option>
			<option value="100ms">100ms</option>
			<option value="10ms">10ms</option>
			<option value="1ms">1ms</option>
			<option value="100us">100us</option>
			<option value="10us">10us</option>
			<option value="1us">1us</option>
		</select>
		<span class="label">VOLTS / DIV:</span>
		<select id="volts" onchange="voltsChanged(this.value);">
			<option value="5V">5V</option>
			<option value="2V">2V</option>
			<option value="1V">1V</option>
			<option value="500mV">500mV</option>
			<option value="200mV">200mV</option>
			<option value="100mV">100mV</option>
		</select>
		<span class="label">Cursor type:</span>
		<select id="curs" onchange="cursor_type_changed(this.value);">
			<option value="0">off</option>
			<option value="1">Voltage</option>
			<option value="2">Time</option>
		</select>
	</div>
</body>
</html>